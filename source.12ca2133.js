parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"wwrx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t,e,h,s,r){this.method=t,this.path=e,this.name=h,this.serverUrl=s,this.handlerFunc=r,this.methodRx=RegExp(t),this.pathRx=RegExp("^"+this.path.replace(/:[^\s/]+/g,"([\\w-]+)")+"$"),this.pathDepth=this.path.split("/").length}compare(t){let e=t.pathDepth-this.pathDepth;return 0==e&&(e=t.path.length-this.path.length),e}match(t,e){if(t.match(this.methodRx)){let t=e.match(this.pathRx);if(t)return t.slice(1)}return null}url(t={}){let e=this.path.substr(1);return Object.keys(t).forEach(h=>{let s=RegExp(`/${h}/g`);e=e.replace(s,t[h])}),new URL(e,this.serverUrl)}}exports.default=t;
},{}],"vov3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./route.js"));function t(e){return e&&e.__esModule?e:{default:e}}class r{constructor(e){this.serverUrl=e,this.routes=[],this.notFoundHandlerFunc=(e=>e.respond({status:404,body:`Handler not found for the "${e.request.method} ${e.request.path}" route on "${e.serverId}" server.`}))}add(t,r,s,u){let d=new e.default(t,r,s,this.serverUrl,u);this.routes.push(d),this.routes.sort((e,t)=>e.compare(t))}addGet(e,t,r){this.add("GET",e,t,r)}addPost(e,t,r){this.add("POST",e,t,r)}find(e,t){let r=[],s=this.routes.find(s=>{let u=s.match(e,t);return null!=u&&(r=u,!0)});return{handlerFunc:s?s.handlerFunc:this.notFoundHandlerFunc,params:r}}get all(){return Array.from(this.routes)}get(e){return this.routes.find(t=>t.name===e)}}exports.default=r;
},{"./route.js":"wwrx"}],"uWiU":[function(require,module,exports) {
"use strict";function e(e){return"string"==typeof e||e instanceof Blob||e instanceof ArrayBuffer||e instanceof FormData||e instanceof URLSearchParams||e instanceof ReadableStream}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t,a,s,n=!1,r,o){var i;let h,d,c=new Headers,p=200;if(void 0===t?p=204:"string"==typeof t?(h="text/html; charset=UTF-8",this.body=t):t instanceof Document?(h="text/html; charset=UTF-8",this.body=(new XMLSerializer).serializeToString(t)):t instanceof Response?(p=t.status,h=null!==(i=t.headers.get("content-type"))&&void 0!==i?i:"",c=new Headers(t.headers),this.body=t.arrayBuffer()):t instanceof File?(h=t.type,d=t.name,this.body=t):t instanceof FormData?(h="multipart/form-data",this.body=t):t instanceof URLSearchParams?(h="application/x-www-form-urlencoded; charset=utf-8",this.body=t):t instanceof Blob?(h=t.type,this.body=t):e(t)?(h="application/octet-stream",this.body=t):(h="application/json",this.body=JSON.stringify(t)),this.headers=c,s&&(n?null==s||s.forEach((e,t)=>this.headers.set(t,e)):this.headers=new Headers(s)),!this.headers.has("content-type")&&h&&this.headers.append("content-type",h),r&&(d=r),o||d){let e=`${o?"attachment":"inline"};`;d&&(e+=` filename*=${this.encode(d)}`),this.headers.has("content-disposition")||this.headers.append("content-disposition",e)}let l=Array.from(this.headers).map(e=>e[0]).join(", ");this.headers.set("httprelay-proxy-headers",l),this.headers.set("httprelay-proxy-status",`${null!=a?a:p}`)}encode(e){return"UTF-8''"+encodeURIComponent(e).replace(/['()]/g,function(e){return"%"+e.charCodeAt(0).toString(16)}).replace(/\*/g,"%2A").replace(/%(7C|60|5E)/g,function(e,t){return String.fromCharCode(parseInt(t,16))})}}exports.default=t;
},{}],"Dvk6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./handler-response.js"));function t(e){return e&&e.__esModule?e:{default:e}}class r{constructor(e,t){this.handlerFunc=e,this.wSecret=t}execute(t){let s=this.handlerFunc(t);return Promise.resolve(s).then(s=>{let o=s instanceof e.default?s:new e.default(s);return o.headers.set("HttpRelay-Proxy-JobId",t.jobId),this.wSecret&&o.headers.set("HttpRelay-WSecret",this.wSecret),Promise.resolve(o.body).then(e=>r.requestInit(t.abortSig,e,o.headers))})}static requestInit(e,t,r){return{method:"SERVE",headers:r,body:t,signal:e}}}exports.default=r;
},{"./handler-response.js":"uWiU"}],"kqSI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./handler-response.js"));function r(e){return e&&e.__esModule?e:{default:e}}class t{constructor(e,r,t,s,o){this.request=e,this.abortSig=r,this.routeParams=t,this.routes=s,this.assets=o}get serverId(){return this.request.headerValue("HttpRelay-Proxy-ServerId")}get jobId(){return this.request.headerValue("HttpRelay-Proxy-JobId")}respond(r={}){return Promise.resolve(r.body).then(t=>new e.default(t,r.status,r.headers,r.mergeHeaders,r.fileName,r.download))}}exports.default=t;
},{"./handler-response.js":"uWiU"}],"TEZX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e{constructor(e){this.response=e}get url(){return new URL(this.headerValue("HttpRelay-Proxy-Url"))}get method(){return this.headerValue("HttpRelay-Proxy-Method")}get path(){return this.headerValue("HttpRelay-Proxy-Path")}get headers(){return this.response.headers}get body(){return this.response.body}arrayBuffer(){return this.response.arrayBuffer()}blob(){return this.response.blob()}formData(){return this.response.formData()}json(){return this.response.json()}text(){return this.response.text()}headerValue(e){let r=this.response.headers.get(e);if(!r)throw new Error(`Unable to find "${e}" header field.`);return r}}exports.default=e;
},{}],"ADnE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t,e){this.url=t,this.settings=e}blob(){return this.blobPro||(this.blobPro=fetch(this.url.href).then(t=>t.status>=200&&t.status<=299?t.blob():void 0,t=>{console.error(t)})),this.blobPro}text(){return this.blob().then(t=>t?t.text():void 0)}}exports.default=t;
},{}],"ZqVL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t,e){this.str=t,this.settings=e}get value(){return"string"==typeof this.str?this.str:this.str()}blob(){return Promise.resolve(new Blob([this.value],{type:"text/html"}))}text(){return Promise.resolve(this.value)}}exports.default=t;
},{}],"tbTn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _assetFetch=_interopRequireDefault(require("./asset-fetch.js")),_assetText=_interopRequireDefault(require("./asset-text.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class Assets{constructor(e,t,s=""){this.routes=e,this.baseUrl=t,this.assetPathPrefix=s,this.assets=[]}add(e){var t;this.assets.push(e),e.settings.mount&&this.routes.addGet(`${this.assetPathPrefix}/${e.settings.name}${e.settings.cache?btoa(Math.random().toString()).substr(5,8):""}`,null!==(t=e.settings.name)&&void 0!==t?t:"Not set",t=>t.respond({body:e.settings.interpolate?this.interpolate(e,t):e.blob(),headers:new Headers({"Cache-Control":e.settings.cache?"public, max-age=31536000, immutable":"no-store"}),mergeHeaders:!0}))}interpolate(asset,ctx){return asset.text().then(t=>{let rx=/\{HR\{(?<expr>[\s\S]+?)\}HR\}/gm,exprPros=[];return null==t||t.replace(rx,(m,g)=>(function(expr){let v="";try{v=eval(expr)}catch(e){console.error(e)}exprPros.push(Promise.resolve(v))}.call(ctx,null!=g?g:""),m)),Promise.all(exprPros).then(e=>null==t?void 0:t.replace(rx,()=>{var t;return null!==(t=e.shift())&&void 0!==t?t:""}))})}addFetch(e,t){e=e instanceof URL?e:new URL(e,this.baseUrl);let s=new _assetFetch.default(e,t);return this.add(s),s}addText(e,t){let s=new _assetText.default(e,t);return this.add(s),s}addLink(e,t){let s=this.assetDefaults(e,t);return this.addFetch(e.href,s)}addTemplate(e,t){let s=this.assetDefaults(e,t);return this.addText(e.innerHTML,s)}assetDefaults(e,t){var s,a,r,n;return{name:null!==(s=null==t?void 0:t.name)&&void 0!==s?s:e.id,mount:null!==(a=null==t?void 0:t.mount)&&void 0!==a?a:e.hasAttribute("data-mount"),interpolate:null!==(r=null==t?void 0:t.interpolate)&&void 0!==r?r:e.hasAttribute("data-interpolate"),cache:null!==(n=null==t?void 0:t.cache)&&void 0!==n?n:e.hasAttribute("data-cache")}}get(e){return this.assets.find(t=>t.settings.name===e)}autoLoad(){Array.from(null===document||void 0===document?void 0:document.getElementsByClassName("httprelay-asset")).forEach(e=>{e instanceof HTMLLinkElement&&this.addLink(e),e instanceof HTMLScriptElement&&this.addTemplate(e)})}}exports.default=Assets;
},{"./asset-fetch.js":"ADnE","./asset-text.js":"ZqVL"}],"U73K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=h(require("./routes.js")),e=h(require("./handler.js")),r=h(require("./handler-ctx.js")),s=h(require("./handler-request.js")),i=h(require("./assets.js"));function h(t){return t&&t.__esModule?t:{default:t}}class a{constructor(e,r,s,h,a){this.proxyUrl=e,this.baseUrl=r,this.serverId=s,this.wSecret=h,this.assetPathPrefix=a,this.errRetry=0,this.serverUrl=new URL(this.serverId+"/",this.proxyUrl),this.routes=new t.default(this.serverUrl),this.assets=new i.default(this.routes,this.baseUrl,this.assetPathPrefix),this.abortCtrl=new AbortController,this.abortSig=this.abortCtrl.signal}start(t=4){null===window||void 0===window||window.addEventListener("beforeunload",()=>this.stop());for(let e=0;e<t;e++)this.serve()}stop(){this.abortCtrl.abort()}serve(t=e.default.requestInit(this.abortSig)){this.abortSig.aborted||fetch(this.serverUrl.href,t).then(t=>{if(200===t.status){this.errRetry=0;let i=new s.default(t),h=this.routes.find(i.method,i.path),a=new r.default(i,this.abortSig,h.params,this.routes,this.assets);new e.default(h.handlerFunc,this.wSecret).execute(a).then(t=>this.serve(t),t=>this.retry(t))}else{let e=`HttpRelay responded ${t.status} while returning result and requesting new job.`;if(t.status>=500&&t.status<=599&&this.retry(e),406!=t.status)throw e;console.warn(e," Client is gone, nowhere to forward the response."),this.serve()}},e=>this.retry(e,t))}retry(t,r=e.default.requestInit(this.abortSig)){if(!this.abortSig.aborted)throw setTimeout(()=>this.serve(r),1e3*this.errRetry++),t}}exports.default=a;
},{"./routes.js":"vov3","./handler.js":"Dvk6","./handler-ctx.js":"kqSI","./handler-request.js":"TEZX","./assets.js":"tbTn"}],"byGQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./proxy/proxy.js"));function e(t){return t&&t.__esModule?t:{default:t}}class r{constructor(t,e){if(this.httpRelayUrl=null!=t?t:new URL("https://demo.httprelay.io"),this.baseUrl=this.httpRelayUrl,!e){let t=null===document||void 0===document?void 0:document.baseURI;if(!t)throw new Error('Base URL "baseUrl" parameter is not set and unable to autodetect');this.baseUrl=new URL(t)}}proxy(e,r,o="proxy/",s=""){return e=null!=e?e:btoa(Math.random().toString()).substr(5,5),r=null!=r?r:btoa(Math.random().toString()).substr(8,8),new t.default(new URL(o,this.httpRelayUrl),this.baseUrl,e,r,s)}}exports.default=r;
},{"./proxy/proxy.js":"U73K"}],"iV6T":[function(require,module,exports) {
"use strict";function e(e){"complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",e):e()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"QCba":[function(require,module,exports) {
"use strict";var e=t(require("httprelay")),r=t(require("@wordpress/dom-ready"));function t(e){return e&&e.__esModule?e:{default:e}}var o=new e.default(new URL("http://p01--http-relay--default-project--ijbe-vwfh.code.run")).proxy();o.routes.addGet("/hello","hello",function(){return"Hello from your browser: ".concat(navigator.appVersion,"!")}),o.start(),(0,r.default)(function(){document.getElementById("proxyUrl").innerHTML=o.proxyUrl.href,document.getElementById("proxyServer").innerHTML=o.serverId,document.getElementById("proxyPath").innerHTML=o.routes.get("hello").path,document.getElementById("serverLink").setAttribute("href",o.routes.get("hello").url().href)});
},{"httprelay":"byGQ","@wordpress/dom-ready":"iV6T"}]},{},["QCba"], null)
//# sourceMappingURL=/csb-xq5pom/source.12ca2133.js.map